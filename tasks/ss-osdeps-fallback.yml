---
# fallback only for ubuntu 14


- name: "Install archivematica-storage-service package dependencies (ref. debian/control)"
  apt:
    pkg: "{{ item }}"
    state: "latest"
  with_items:
    - "nginx"
    - "unar"
    - "rsync"
    - "uwsgi"
    - "uwsgi-plugin-python"
    - "gnupg"
    - "rng-tools"
  tags: "amsrc-ss-osdep"

- name: "Install archivematica-storage-service additional package dependencies"
  apt:
    pkg: "{{ item }}"
    state: "latest"
  with_items:
    - "python-virtualenv"
    - "python-dev"
    - "libxml2-dev"
    - "libxslt1-dev"
    - "libz-dev"
    - "libffi-dev"
    - "libssl-dev"
    - "gettext"
  tags: "amsrc-ss-osdep"

- name: "Configure rng-tools"
  lineinfile:
    dest: "/etc/default/rng-tools"
    line: "HRNGDEVICE=/dev/urandom"
    insertafter: "^#HRNGDEVICE"
    state: "present"
  tags: "rng-tools"
  become: "yes"

- name: "Start rng-tools"
  command: "/etc/init.d/rng-tools start"
  tags: "rng-tools"
